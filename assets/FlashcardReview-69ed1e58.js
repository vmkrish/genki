var C=Object.defineProperty;var N=(t,e,o)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var a=(t,e,o)=>(N(t,typeof e!="symbol"?e+"":e,o),o);import{d as f,r as c,a as O,o as u,c as d,w as s,b as n,e as $,f as J,u as h,V as F,g as R,h as m,i as r,t as i,j,k as g,l as q,m as L}from"./index-3339df3f.js";function A(){return new x}function y(t){const e=JSON.parse(t);return Object.assign(new x,e)}class x{constructor(){a(this,"id","");a(this,"last_millis",0);a(this,"next_millis",0);a(this,"front","front");a(this,"back","back");a(this,"level",0)}get last(){return new Date(this.last_millis)}get next(){return new Date(this.next_millis)}correct(){this.last_millis=new Date().getTime(),this.next_millis=this.last_millis+24*60*60*1e3,this.level+=1}incorrect(){this.last_millis=new Date().getTime(),this.next_millis=this.last_millis+24*60*60*1e3,this.level>1&&(this.level-=1)}}const T={key:0},E=m("br",null,null,-1),K=m("br",null,null,-1),Q=f({data(){return{showBack:!1,myData:"",srsItem:A()}},watch:{myData(t,e){console.log(`new: ${t}, old: ${e}`),t&&t!=localStorage.getItem("myData")&&localStorage.setItem("myData",t)},cardId(t,e){console.log(`** found new card-id: ${e} => ${t} **`),e&&localStorage.getItem(e)&&localStorage.setItem(e,JSON.stringify(this.srsItem)),t&&localStorage.getItem(t)&&(this.srsItem=y(localStorage.getItem(t)))},srsItem:{handler:function(t,e){console.log(`srsItem: ${JSON.stringify(e)} => ${JSON.stringify(t)}`),(!e||t.last!=e.last)&&(console.log("srsItem: updating localstorage"),localStorage.setItem("srs",JSON.stringify(t)))},deep:!0}},mounted(){console.log("** mounted **"),localStorage.getItem("myData")&&(console.log("** found myData **"),this.myData=localStorage.getItem("myData")),this.cardId&&localStorage.getItem(this.cardId)?(console.log("** found card-id **"),this.srsItem=y(localStorage.getItem(this.cardId))):localStorage.getItem("srs")&&(console.log("** found srs **"),this.srsItem=y(localStorage.getItem("srs"))),window.addEventListener("keyup",t=>{switch(t.key){case"ArrowDown":this.showBack=!this.showBack;break;case"ArrowLeft":this.showBack&&this.yes();break;case"ArrowRight":this.showBack&&this.no();break}})},methods:{swipe:t=>{console.log(t+" swipe")},yes:function(){this.myData="yes",this.srsItem&&this.srsItem.correct(),this.next()},no:function(){this.myData="no",this.srsItem&&this.srsItem.incorrect(),this.repeat()}}}),U=f({...Q,__name:"Flashcard",props:{cardId:{},next:{type:Function},repeat:{type:Function}},setup(t){return(e,o)=>{const _=c("v-card-text"),p=c("v-container"),I=c("v-btn"),v=c("v-col"),b=c("v-row"),B=c("v-card-actions"),w=O("touch");return u(),d(p,{style:{"max-width":"700px"}},{default:s(()=>[n(h(L),{variant:"tonal",style:{margin:"auto"}},{default:s(()=>[$((u(),d(p,{style:{"min-height":"300px",margin:"auto"},justify:"center","vertical-align":"middle",onClick:o[0]||(o[0]=l=>e.showBack=!e.showBack),onKeyup:o[1]||(o[1]=J(l=>e.showBack=!e.showBack,["down"]))},{default:s(()=>[n(h(F),{style:{height:"200px"},"vertical-align":"middle","text-align":"middle"},{default:s(()=>[n(h(R),{"vertical-align":"middle",class:"text-xs-h1 text-smAndUp-h1"},{default:s(()=>{var l;return[m("ruby",null,[r(i((l=e.srsItem)==null?void 0:l.front)+" ",1),e.showBack?(u(),j("rt",T,"furigana")):g("",!0)])]}),_:1}),n(h(q),null,{default:s(()=>[r(i(e.cardId)+" / "+i(e.myData),1)]),_:1})]),_:1}),e.showBack?(u(),d(_,{key:0,class:"text-h3 pa-2",style:{"font-family":"'Open Sans'"}},{default:s(()=>{var l,S,k;return[r(i((l=e.srsItem)==null?void 0:l.back)+" ",1),E,r(" Level: "+i((S=e.srsItem)==null?void 0:S.level)+" ",1),K,r(" "+i((k=e.srsItem)==null?void 0:k.last.toLocaleDateString()),1)]}),_:1})):g("",!0)]),_:1})),[[w,()=>{console.log("Left swipe")},"swipe",{left:!0}],[w,e.swipe,"swipe"]])]),_:1}),e.showBack?(u(),d(B,{key:0,style:{padding:"0px",margin:"0px"}},{default:s(()=>[n(p,{style:{padding:"0"}},{default:s(()=>[n(b,{class:"d-flex justify-space-between"},{default:s(()=>[n(v,{cols:"auto"},{default:s(()=>[n(I,{variant:"tonal",onClick:e.yes},{default:s(()=>[r(" Yes ")]),_:1},8,["onClick"])]),_:1}),n(v,{cols:"auto"},{default:s(()=>[n(I,{variant:"tonal",onClick:e.no},{default:s(()=>[r(" No ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})}}});class Y{constructor(){a(this,"id","");a(this,"queue",[])}}class D extends Y{constructor(){super(...arguments);a(this,"index",0)}}const z=f({data(){return{session:new D}},computed:{current:function(){if(this.session.index<this.session.queue.length)return this.session.queue[this.session.index]}},mounted(){if(console.log("** mounted **"),localStorage.getItem("srs-queue")){console.log("** found srs-queue **");let t=JSON.parse(localStorage.getItem("srs-queue"));Object.assign(D,t),this.session=t,this.session.index=0}},methods:{next:function(){console.log("** next **"),this.session.index+=1},repeat:function(){console.log("** repeat **"),this.session.index+=1}}}),M=f({...z,__name:"FlashcardReview",setup(t){return(e,o)=>{const _=c("v-container");return u(),d(_,{style:{"max-width":"800px"}},{default:s(()=>[m("p",null,i(JSON.stringify(e.session)),1),m("p",null,i(e.current),1),e.current?(u(),d(U,{key:0,"card-id":e.current,next:e.next,repeat:e.repeat},null,8,["card-id","next","repeat"])):g("",!0)]),_:1})}}});export{M as default};
